(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{426:function(s,a,t){"use strict";t.r(a);var n=t(10),p=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"app-api-签名与鉴权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-api-签名与鉴权"}},[s._v("#")]),s._v(" APP API 签名与鉴权")]),s._v(" "),a("h2",{attrs:{id:"app-api-签名特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-api-签名特性"}},[s._v("#")]),s._v(" APP API 签名特性")]),s._v(" "),a("p",[s._v("部分客户端专用的 REST API 存在基于参数签名的鉴权，需要使用规定的"),a("code",[s._v("appkey")]),s._v("及其对应的"),a("code",[s._v("appsec")]),s._v("与原始请求参数进行签名计算，部分"),a("code",[s._v("AppKey")]),s._v("及与之对应的"),a("code",[s._v("AppSec")]),s._v("已经被公开：见该文档 "),a("RouterLink",{attrs:{to:"/docs/misc/sign/APPKey.html"}},[s._v("APPKey")])],1),s._v(" "),a("ul",[a("li",[a("p",[s._v("不同 "),a("code",[s._v("appkey")]),s._v(" 对应不同的 app (如客户端、概念版、必剪、漫画、bililink等)")])]),s._v(" "),a("li",[a("p",[s._v("不同平台同 app 也会存在不同的 "),a("code",[s._v("appkey")]),s._v(" (如安卓端、ios端、TV端等)")])]),s._v(" "),a("li",[a("p",[s._v("同平台同 app 下不同功能也会存在不同的 "),a("code",[s._v("appkey")]),s._v("（如登录专用、取流专用等）")])]),s._v(" "),a("li",[a("p",[s._v("不同版本的客户端的 "),a("code",[s._v("appkey")]),s._v(" 也可能不同")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("appkey与appsec一一对应")])])])]),s._v(" "),a("h2",{attrs:{id:"app-api-签名算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-api-签名算法"}},[s._v("#")]),s._v(" APP API 签名算法")]),s._v(" "),a("ol",[a("li",[s._v("首先为参数中添加"),a("code",[s._v("appkey")]),s._v("字段")]),s._v(" "),a("li",[s._v("然后按照参数的 Key 重新排序")]),s._v(" "),a("li",[s._v("再对这个 Key-Value 进行 url query 序列化，并拼接与之对应的"),a("code",[s._v("appsec")]),s._v(" (盐) 进行 "),a("strong",[s._v("md5 Hash 运算")]),s._v("（32-bit 字符小写），该 hash 便是 API 签名")]),s._v(" "),a("li",[s._v("最后在参数尾部增添"),a("code",[s._v("sign")]),s._v("字段，它的 Value 为上一步计算所得的 hash，一并作为表单或 Query 提交")])]),s._v(" "),a("h2",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[s._v("#")]),s._v(" Demo")]),s._v(" "),a("p",[s._v("该 Demo 提供 "),a("a",{attrs:{href:"#Python"}},[s._v("Python")]),s._v(" 语言例程")]),s._v(" "),a("p",[s._v("使用 appkey = "),a("code",[s._v("1d8b6e7d45233436")]),s._v(", appsec = "),a("code",[s._v("560c52ccd288fed045859ed18bffd973")]),s._v(" 对如下 "),a("code",[s._v("params")]),s._v(" 参数进行签名")]),s._v(" "),a("p",[s._v("上述示例"),a("code",[s._v("appkey")]),s._v("、"),a("code",[s._v("AppSec")]),s._v("均来自文档 "),a("RouterLink",{attrs:{to:"/docs/misc/sign/APPKey.html"}},[s._v("APPKey")])],1),s._v(" "),a("h3",{attrs:{id:"python"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#python"}},[s._v("#")]),s._v(" Python")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" hashlib\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("appsign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'为请求参数进行 APP 签名'")]),s._v("\n    params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'appkey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    params "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("sorted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照 key 重排参数")]),s._v("\n    query "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urlencode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 序列化参数")]),s._v("\n    sign "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hashlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hexdigest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 计算 api 签名")]),s._v("\n    params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sign'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("sign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" params\n\nappkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1d8b6e7d45233436'")]),s._v("\nappsec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'560c52ccd288fed045859ed18bffd973'")]),s._v("\nparams "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114514")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'str'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1919810'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'いいよ，こいよ'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nsigned_params "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" appsign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nquery "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urlencode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signed_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signed_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("输出内容分别是进行 APP 签名的后参数的 key-Value 以及 url query 形式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{'appkey': '1d8b6e7d45233436', 'id': 114514, 'str': '1919810', 'test': 'いいよ，こいよ', 'sign': '01479cf20504d865519ac50f33ba3a7d'}\nappkey=1d8b6e7d45233436&id=114514&str=1919810&test=%E3%81%84%E3%81%84%E3%82%88%EF%BC%8C%E3%81%93%E3%81%84%E3%82%88&sign=01479cf20504d865519ac50f33ba3a7d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=p.exports}}]);